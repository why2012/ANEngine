<!DOCTYPE html>
<head>
	<title>ANEngine</title>
	<script type="text/javascript" src="ANEngine/jquery-2.0.2.min.js"></script>
	<script type="text/javascript" src="ANEngine/Box2dWeb-2.1.a.3.js"></script>
	<script type="text/javascript" src="ANEngine/ANEngine.js"></script>
	<script type="text/javascript" src="ANEngine/ANEngine.Util.js"></script>
</head>
<body>
	<script>
		window.onload = function(){
			$(window).resize(function()
			{
				document.getElementById("canvas").width = $(window).width();
				document.getElementById("canvas").height = $(window).height();		
			});
			document.getElementById("canvas").width = $(window).width();
			document.getElementById("canvas").height = $(window).height();

			var scene = new ANEngine.Scene(document.getElementById("canvas"));
			var layer = new ANEngine.Layer();
			var spriteA = new ANEngine.Sprite(4,2,2,2);
			var spriteB = new ANEngine.Sprite(3,11,30,2,.3);
			var spriteC = new ANEngine.Sprite(8,0,4,4);
			var spriteD = new ANEngine.Sprite(28,8,12,2,Math.PI/2);
			var spriteE = new ANEngine.Sprite(6,0,2,2);
			var particle = new ANEngine.MovieClip(15,2.5,3,3);
			particle.blend("lighter");
			var movieClip = new ANEngine.MovieClip(5,3,4,4);
			//设置物理皮肤
			var phyData = {type:ANEngine.physicalEngine.PhysicsAttr.Type.Dynamic,shape:ANEngine.physicalEngine.PhysicsAttr.Shape.Box};
			phyData.type = ANEngine.physicalEngine.PhysicsAttr.Type.Static;
			spriteB.physicalSkin.setPhysics(phyData);
			spriteD.physicalSkin.setPhysics(phyData);
			phyData.type = ANEngine.physicalEngine.PhysicsAttr.Type.Dynamic;
			phyData.shape = ANEngine.physicalEngine.PhysicsAttr.Shape.Circle;
			spriteA.physicalSkin.setPhysics(phyData);
			spriteC.physicalSkin.setPhysics(phyData);
			spriteE.physicalSkin.setPhysics(phyData);
			phyData.restitution = .8;
			particle.physicalSkin.setPhysics(phyData);
			phyData.restitution = .3;
			phyData.shape = ANEngine.physicalEngine.PhysicsAttr.Shape.Box;
			movieClip.physicalSkin.setPhysics(phyData);

			//设置背景贴图
			var image = new Image();
			image.src = "assets/bird2.png";
			image.onload = function(){
				spriteA.setChartlet(image);
			};
			var image2 = new Image();
			image2.src = "assets/bird1.png";
			image2.onload = function(){
				spriteC.setChartlet(image2);
				layer.addAnimItem(spriteC.Clone());
			};
			var image3 = new Image();
			image3.src = "assets/glass.png";
			image3.onload = function(){
				spriteB.setChartlet(image3);
			};
			var image4 = new Image();
			image4.src = "assets/wood.png";
			image4.onload = function(){
				spriteD.setChartlet(image4);
			};
			var image5 = new Image();
			image5.src = "assets/bird3.png";
			image5.onload = function(){
				spriteE.setChartlet(image5);
			};
			var image6 = new Image();
			image6.src = "assets/eff.png";
			image6.onload = function(){
				$.get("assets/eff.xml",{},function(xml){
					particle.setSpriteSheet(image6,ANEngine.Util.MovieClip.XmlToJson(xml),24);
					layer.addAnimItem(particle.Clone());	
				},"xml");
			};
			var spriteimage1 = new Image();
			spriteimage1.src = "assets/zombie1.png";
			spriteimage1.onload = function(){
				$.getJSON("assets/zombie1.json",function(json){
					movieClip.setSpriteSheet(spriteimage1,json,24);
					//console.log(movieClip.totalFrame());
				});
			};
			var bg = new Image();
			bg.src = "assets/bg.png";
			bg.onload = function()
			{
				scene.setBG(bg);
			}

			//添加Sprite，图层，物理外形
			layer.addAnimItem(spriteA);
			layer.addAnimItem(spriteB);
			layer.addAnimItem(spriteC);
			layer.addAnimItem(spriteD);
			layer.addAnimItem(spriteE);
			layer.addAnimItem(movieClip);
			layer.addAnimItem(particle);
			scene.addLayer(layer);
			spriteA.physicalSkin.addToPhyWorld();
			spriteB.physicalSkin.addToPhyWorld();
			spriteC.physicalSkin.addToPhyWorld();
			spriteD.physicalSkin.addToPhyWorld();
			spriteE.physicalSkin.addToPhyWorld();
			movieClip.physicalSkin.addToPhyWorld();
			particle.physicalSkin.addToPhyWorld();

			/*spriteA.drawInCanvas(function(canvas,g)
				{
					g.drawPhyBorder(canvas);
					g.drawSpriteBorder(canvas);
				});*/
			//画出物理边框和Sprite边框
			spriteA.drawBorder = true;
			spriteB.drawBorder = true;
			spriteC.drawBorder = true;
			spriteD.drawBorder = true;
			spriteE.drawBorder = true;
			movieClip.drawBorder = true;

			//spriteC.alpha(.5);
			//spriteC.scale(.5,.5);
			//layer.removeAnimItem(spriteC);
			//spriteC.physicalSkin.destroyPhy();
			//layer.addAnimItem(spriteC);

			//睡眠
			//spriteC.physicalSkin.setAwakePhy(false);
			//var px=0,py=0;
			//移动物体
			//spriteC.physicalSkin.setTransformPhy(px,py);px+=.02;py+=.01;
			//移动物体 Joint Transform
			//spriteE.physicalSkin.setJointTransform(80,20);

			//鼠标控制
			var baseController = new ANEngine.physicalEngine.BaseController(document.getElementById("canvas"),scene.phyWorld);
			//渲染
			setInterval(function(){
				//向物体物体中心施加力，单位牛
				spriteA.physicalSkin.applyForceToCenterPhy(40000,30000);
				baseController.update();
				ANEngine.render(scene);
			},1000/ANEngine.fps);
		}
	</script>
	<canvas id="canvas" style="position:absolute;left:0;top:0;">Your browser does not support the HTML5 canvas tag.</canvas>
</body>